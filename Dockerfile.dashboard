FROM golang:1.21-alpine AS builder

WORKDIR /app
COPY . .

# Install dependencies
RUN go mod download

# Build the dashboard
RUN go build -o k8s-lens-dashboard cmd/dashboard/main.go cmd/dashboard/handlers.go

FROM alpine:latest

RUN apk --no-cache add ca-certificates

WORKDIR /root/

# Copy the binary and web assets
COPY --from=builder /app/k8s-lens-dashboard .
COPY --from=builder /app/web ./web

EXPOSE 8080

CMD ["./k8s-lens-dashboard"]